# Тестовое задание

## Задача
 * Есть очередь в Редисе (возможно через стрим). 
 * Несколько производителей непрерывно генерируют случайные целые числа в диапазоне и пишут их в эту очередь. Сгенерированные числа могут повторяться. Производитель не отслеживает уникальность отправляемых чисел, не имеет данных о других производителях, не хранит список сгенерированных чисел. 
 * Потребитель вычитывает числа из очереди. Если такое число уже было получено, то оно игнорируется. Если нет, то вместе числом сохраняется дата когда было получено число. 
 * Когда потребитель собрал все возможные числа в диапазоне, процесс генерации и потребления чисел останавливается, результат нужно сохранить в виде JSON в файловую систему. 
 
### Конфигурируется
 * Количество производителей 
 * Диапазон случайных чисел 

### Пример JSON с результатами для записи в файл
```json
 { "timeSpent": 1000, "numbersGenerated": [{"value": 1, "date": "..."}]}
```

## Реализация

### Установка 

```bash
# Установить зависимости
yarn install

# Запустить Redis
docker-compose up -d
```

### Запуск

```bash
yarn start --producers 4 --min 1 --max 100 --output output.json
```

*(Опционально)* Сначала скомпилировать, потом запустить:

```bash
yarn build
node dist/index.js --min 1 --max 100
```

## Опции

| Флаг                       | Описание                                                        | По умолчанию             |
| -------------------------- | --------------------------------------------------------------- | ------------------------ |
| `-p, --producers <number>` | Число параллельных производителей случайных чисел               | `CPU_cores × 2`          |
| `--min <number>`           | Минимальное значение генерируемого целого числа (включительно)  | **обязательно**          |
| `--max <number>`           | Максимальное значение генерируемого целого числа (включительно) | **обязательно**          |
| `-r, --redis <url>`        | URL подключения к Redis                                         | `redis://localhost:6379` |
| `-o, --output <path>`      | Путь к JSON-файлу для сохранения результата                     | `result.json`            |
| `-b, --batchSize <number>` | Количество записей за одну операцию `XREADGROUP`                | `1000`                   |
| `-g, --groupName <name>`   | Название Consumer Group в Redis Streams                         | `number-collector-group` |
